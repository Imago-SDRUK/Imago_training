bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
p_map <- ggplot(msoa_bi) +
geom_sf(aes(fill = bi_class), colour = NA) +
scale_fill_manual(values = biv_palette) +
labs(
title = "Bivariate Map: Summer Temp and Health Deprivation",
fill = "Bivariate class",
subtitle = "Summer Max Temp (x-axis) × Health Rank (y-axis)"
) +
theme_void() +
theme(
legend.position = "none",
plot.title = element_text(face = "bold")
)
p_map <- ggplot(msoa_bi) +
geom_sf(aes(fill = bi_class), colour = NA) +
scale_fill_manual(values = bi_palette) +
labs(
title = "Bivariate Map: Summer Temp and Health Deprivation",
fill = "Bivariate class",
subtitle = "Summer Max Temp (x-axis) × Health Rank (y-axis)"
) +
theme_void() +
theme(
legend.position = "none",
plot.title = element_text(face = "bold")
)
# Build legend grid (3x3)
legend_df <- expand_grid(
summer_class = 1:3,
health_class = 1:3
) %>%
mutate(
bi_class = paste0(summer_class, "-", health_class),
fill = biv_palette[bi_class]
)
# Build legend grid (3x3)
legend_df <- expand_grid(
summer_class = 1:3,
health_class = 1:3
) %>%
mutate(
bi_class = paste0(summer_class, "-", health_class),
fill = bi_palette[bi_class]
)
p_legend <- ggplot(legend_df, aes(x = summer_class, y = health_class, fill = fill)) +
geom_tile() +
scale_fill_identity() +
coord_equal() +
theme_void() +
theme(
panel.border = element_rect(colour = "black", fill = NA),
plot.margin = margin(0, 0, 0, 0)
)
final_map <- ggdraw() +
draw_plot(p_map) +
draw_plot(
p_legend,
x = 0.75, y = 0.05,      # bottom-right corner
width = 0.2, height = 0.2
)
final_map
ggsave(
filename = "/Users/pietrost/Dropbox/GitHub/Imago-SDRUK/DataProduct-CLiVE/code/applications/plots/heat_health_bivariate_map_msoa_2023.png",
plot = final_map,
width = 8,
height = 6,
dpi = 600,
bg = "transparent"
)
# Playing around with tmap
tmap_mode("view")
bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
tm_shape(msoa_bi) +
tm_polygons(
fill = tm_vars(c("summer_class", "health_class"), multivariate = TRUE),
fill.scale = tm_scale_bivariate(
scale1 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
scale2 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
values = bi_palette
)) +
tm_borders(lwd = 0.01, alpha=0) +
tm_layout(frame = FALSE) +
tm_crs("auto")
msoa_hotspots <- msoa_final_clean %>%
mutate(
summertemp_decile = ntile(summer_max_tmp, 3),             # hottest
health_decile = ntile(-health_rank_msoa, 3)      # most deprived
) %>%
filter(summertemp_decile == 3 & health_decile == 3)  # hottest + most deprivation
msoa_hotspots <- st_as_sf(msoa_hotspots)
ggplot(msoa_final_clean, aes(x =summer_max_tmp, y = health_rank_msoa)) +
geom_point(alpha = 0.3) +
geom_point(data = msoa_hotspots, colour = "red", size = 2) +
labs(
title = "Deprivation (MSOA-level) vs. Summer temp.",
x = "Summer (°C)",
y = "IMD rank (lower = more deprived)"
) +
theme_minimal()
msoa_bi_hotspots <- msoa_final_clean %>%
mutate(
summertemp_class = ntile(summer_max_tmp, 5),
health_class  = ntile(-health_rank_msoa, 5),
bi_class   = paste0(summertemp_class, "-", health_class)
) %>%
filter(bi_class == "3-3")
msoa_bi_hotspots <- msoa_final_clean %>%
mutate(
summertemp_decile = ntile(summer_max_tmp, 5),             # 10 = hottest
health_decile = ntile(-health_rank_msoa, 5)      # 10 = most deprived
) %>%
filter(summertemp_decile == 5 & health_decile == 5)  # hottest + high deprivation
msoa_bi_hotspots <- st_as_sf(msoa_bi_hotspots)
ggplot() +
# Base map in light grey
geom_sf(
data = msoa_final_clean,
fill = "grey50",
colour = "grey70",
size = 0.1
) +
# Hotspots overlay (3–3 class)
geom_sf(
data = msoa_bi_hotspots,
fill = "darkred",
colour = "darkred",
size = 0.25,
alpha = 0.9
) +
labs(
title = "Summer Hot Spots × Health Deprivation Hotspots",
subtitle = "MSOA Level",
caption = "Sources: Temp estimates, IMD 2025"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 10),
legend.position = "none",
plot.caption = element_text(size = 8)
)
msoa_bi_hotspots <- msoa_final_clean %>%
mutate(
summertemp_class = ntile(summer_max_tmp, 3),
health_class  = ntile(-health_rank_msoa, 3),
bi_class   = paste0(summertemp_class, "-", health_class)
) %>%
filter(bi_class == "3-3")
msoa_bi_hotspots <- msoa_final_clean %>%
mutate(
summertemp_decile = ntile(summer_max_tmp, 3),             # 10 = hottest
health_decile = ntile(-health_rank_msoa, 3)      # 10 = most deprived
) %>%
filter(summertemp_decile == 3 & health_decile == 3)  # hottest + high deprivation
msoa_bi_hotspots <- st_as_sf(msoa_bi_hotspots)
ggplot() +
# Base map in light grey
geom_sf(
data = msoa_final_clean,
fill = "grey50",
colour = "grey70",
size = 0.1
) +
# Hotspots overlay (3–3 class)
geom_sf(
data = msoa_bi_hotspots,
fill = "darkred",
colour = "darkred",
size = 0.25,
alpha = 0.9
) +
labs(
title = "Summer Hot Spots × Health Deprivation Hotspots",
subtitle = "MSOA Level",
caption = "Sources: Temp estimates, IMD 2025"
) +
theme_minimal() +
theme(
plot.title = element_text(face = "bold", size = 10),
legend.position = "none",
plot.caption = element_text(size = 8)
)
View(msoa_bi)
# Playing around with tmap
tmap_mode("view")
msoa_bi <- msoa_bi %>%
select(
msoa21cd,      # MSOA code
msoa21nm,      # MSOA name
ladnm,         # Local authority name
health_rank_msoa,
summer_max_tmp
) %>%
rename(
MSOA_code = msoa21cd,
MSOA_name = msoa21nm,
Local_authority = ladnm,
Health_rank = health_rank_msoa,
Summer_max_temp = summer_max_tmp
)
bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
tm_shape(msoa_bi) +
tm_polygons(
fill = tm_vars(c("summer_class", "health_class"), multivariate = TRUE),
fill.scale = tm_scale_bivariate(
scale1 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
scale2 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
values = bi_palette
)) +
tm_borders(lwd = 0.01, alpha=0) +
tm_layout(frame = FALSE) +
tm_crs("auto")
msoa_bi <- msoa_final_clean %>%
mutate(
summer_class = ntile(summer_max_tmp, 3),        # 1 = low exposure, 3 = high
health_class  = ntile(-health_rank_msoa, 3),    # -rank so 1 = least deprived → 3 = most deprived
bi_class   = paste0(summer_class, "-", health_class)
)
# Playing around with tmap
tmap_mode("view")
msoa_bi_interactive <- msoa_bi %>%
select(
msoa21cd,      # MSOA code
msoa21nm,      # MSOA name
ladnm,         # Local authority name
health_rank_msoa,
summer_max_tmp,
geometry
) %>%
rename(
MSOA_code = msoa21cd,
MSOA_name = msoa21nm,
Local_authority = ladnm,
Health_rank = health_rank_msoa,
Summer_max_temp = summer_max_tmp
)
View(msoa_final_clean)
msoa_bi <- msoa_final_clean %>%
mutate(
summer_class = ntile(summer_max_tmp, 3),        # 1 = low exposure, 3 = high
health_class  = ntile(-health_rank_msoa, 3),    # -rank so 1 = least deprived → 3 = most deprived
bi_class   = paste0(summer_class, "-", health_class)
)
# Playing around with tmap
tmap_mode("view")
msoa_bi_interactive <- msoa_bi %>%
select(
msoa21cd,      # MSOA code
msoa21nm,      # MSOA name
ladnm,         # Local authority name
health_rank_msoa,
summer_max_tmp,
geom
) %>%
rename(
MSOA_code = msoa21cd,
MSOA_name = msoa21nm,
Local_authority = ladnm,
Health_rank = health_rank_msoa,
Summer_max_temp = summer_max_tmp
)
bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
tm_shape(msoa_bi) +
tm_polygons(
fill = tm_vars(c("summer_class", "health_class"), multivariate = TRUE),
fill.scale = tm_scale_bivariate(
scale1 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
scale2 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
values = bi_palette
)) +
tm_borders(lwd = 0.01, alpha=0) +
tm_layout(frame = FALSE) +
tm_crs("auto")
reticulate::repl_python()
# Playing around with tmap
tmap_mode("view")
msoa_bi_interactive <- msoa_bi %>%
select(
msoa21cd,      # MSOA code
msoa21nm,      # MSOA name
ladnm,         # Local authority name
health_rank_msoa,
summer_max_tmp,
geom
) %>%
rename(
`MSOA code` = msoa21cd,
`MSOA name` = msoa21nm,
`Local authority` = ladnm,
`Health rank` = health_rank_msoa,
`Summer max temp` = summer_max_tmp
)
bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
tm_shape(msoa_bi_interactive) +
tm_polygons(
fill = tm_vars(c("summer_class", "health_class"), multivariate = TRUE),
fill.scale = tm_scale_bivariate(
scale1 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
scale2 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
values = bi_palette
)) +
tm_borders(lwd = 0.01, alpha=0) +
tm_layout(frame = FALSE) +
tm_crs("auto")
# Playing around with tmap
tmap_mode("view")
msoa_bi_interactive <- msoa_bi %>%
select(
msoa21cd,      # MSOA code
msoa21nm,      # MSOA name
ladnm,         # Local authority name
health_rank_msoa,
summer_max_tmp,
geom
) %>%
rename(
`MSOA code` = msoa21cd,
`MSOA name` = msoa21nm,
`Local authority` = ladnm,
`Health rank` = health_rank_msoa,
`Summer max temp` = summer_max_tmp
)
bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
tm_shape(msoa_bi_interactive) +
tm_polygons(
fill = tm_vars(c("Summer max temp", "Health rank"), multivariate = TRUE),
fill.scale = tm_scale_bivariate(
scale1 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
scale2 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
values = bi_palette
)) +
tm_borders(lwd = 0.01, alpha=0) +
tm_layout(frame = FALSE) +
tm_crs("auto")
msoa_bi <- msoa_final_clean %>%
mutate(
summer_class = ntile(summer_max_tmp, 3),        # 1 = low exposure, 3 = high
health_class  = ntile(-health_rank_msoa, 3),    # -rank so 1 = least deprived → 3 = most deprived
bi_class   = paste0(summer_class, "-", health_class)
)
# Playing around with tmap
tmap_mode("view")
msoa_bi_interactive <- msoa_bi %>%
select(
msoa21cd,      # MSOA code
msoa21nm,      # MSOA name
ladnm,         # Local authority name
health_rank_msoa,
summer_max_tmp,
geom
) %>%
rename(
`MSOA code` = msoa21cd,
`MSOA name` = msoa21nm,
`Local authority` = ladnm,
`Health rank` = health_rank_msoa,
`Summer max temp` = summer_max_tmp
)
bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
tm_shape(msoa_bi_interactive) +
tm_polygons(
fill = tm_vars(c("Summer max temp", "Health rank"), multivariate = TRUE),
fill.scale = tm_scale_bivariate(
scale1 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
scale2 = tm_scale_intervals(style = "kmeans", n = 3, labels = c("L", "M", "H")),
values = bi_palette
)) +
tm_borders(lwd = 0.01, alpha=0) +
tm_layout(frame = FALSE) +
tm_crs("auto")
msoa_bi <- msoa_final_clean %>%
mutate(
summer_class = ntile(summer_max_tmp, 3),        # 1 = low exposure, 3 = high
health_class  = ntile(-health_rank_msoa, 3),    # -rank so 1 = least deprived → 3 = most deprived
bi_class   = paste0(summer_class, "-", health_class)
)
bi_palette <- c(
"1-1" = "#D9EBF5", # low heat, low deprivation (very light blue)
"2-1" = "#E8E0D5", # medium heat, low deprivation (warm beige)
"3-1" = "#F5B895", # high heat, low deprivation (warm orange-peach)
"1-2" = "#ACD4E8", # low heat, medium deprivation (light blue)
"2-2" = "#D5D5D5",
"3-2" = "#E67676",
"1-3" = "#6A9ABD", # low heat, high deprivation (medium-light blue)
"2-3" = "#C99191", # medium heat, high deprivation (lighter rose)
"3-3" = "#C83737"  # high heat, high deprivation (dark red)
)
p_map <- ggplot(msoa_bi) +
geom_sf(aes(fill = bi_class), colour = NA) +
scale_fill_manual(values = bi_palette) +
labs(
title = "Bivariate Map: Summer Temp and Health Deprivation",
fill = "Bivariate class",
subtitle = "Summer Max Temp (x-axis) × Health Rank (y-axis)"
) +
theme_void() +
theme(
legend.position = "none",
plot.title = element_text(face = "bold")
)
# Build legend grid (3x3)
legend_df <- expand_grid(
summer_class = 1:3,
health_class = 1:3
) %>%
mutate(
bi_class = paste0(summer_class, "-", health_class),
fill = bi_palette[bi_class]
)
p_legend <- ggplot(legend_df, aes(x = summer_class, y = health_class, fill = fill)) +
geom_tile() +
scale_fill_identity() +
coord_equal() +
theme_void() +
theme(
panel.border = element_rect(colour = "black", fill = NA),
plot.margin = margin(0, 0, 0, 0)
)
final_map <- ggdraw() +
draw_plot(p_map) +
draw_plot(
p_legend,
x = 0.75, y = 0.05,      # bottom-right corner
width = 0.2, height = 0.2
)
final_map
reticulate::repl_python()
msoa_bi_hotspots <- msoa_final_clean %>%
mutate(
summertemp_class = ntile(summer_max_tmp, 3),
health_class  = ntile(-health_rank_msoa, 3),
bi_class   = paste0(summertemp_class, "-", health_class)
) %>%
filter(bi_class == "3-3")
msoa_bi_hotspots <- msoa_final_clean %>%
mutate(
summertemp_decile = ntile(summer_max_tmp, 3),             # 10 = hottest
health_decile = ntile(-health_rank_msoa, 3)      # 10 = most deprived
) %>%
filter(summertemp_decile == 3 & health_decile == 3)  # hottest + high deprivation
msoa_bi_hotspots <- st_as_sf(msoa_bi_hotspots)
reticulate::repl_python()
